/*
 * WRScroller - v0.3.0-alpha - 2014-09-24
 * A very simple jQuery scroller.
 * https://github.com/wruth/wrscroller
 *
 * Copyright (c) 2014 Ward Ruth
 * Under MIT License
 */
!function(a){function b(a){if("none"===a)return["1","0","0","1","0","0"];var b=a.indexOf("(")+1,c=a.slice(b,-1),d=c.split(",");return d}function c(a){return"matrix("+a.join(", ")+")"}function d(a){return{identifier:a.identifier,pageX:a.pageX,pageY:a.pageY}}function e(b){var c=this.$el;this.$previous=c.find(b.previouseSelector),this.$next=c.find(b.nextSelector),this.$viewport=c.find(b.viewportSelector),this.$scrollContainer=a(this.$viewport.children()[0]),this.settings=b,this.viewportWidth=this.$viewport.outerWidth(),this.scrollChildrenWidth=f.call(this),this.numSteps=Math.ceil(this.scrollChildrenWidth/this.viewportWidth),this.stepIndex=0,this.isAtStart=!0,this.isAtEnd=this.scrollChildrenWidth<=this.viewportWidth,g.call(this,!0),this.$previous&&this.$previous.addClass("disabled"),this.isAtEnd&&this.$next&&this.$next.addClass("disabled"),this.touch=null,h.call(this)}function f(){var b=0;return this.$scrollContainer.children().each(function(){b+=a(this).outerWidth(!0)}),this.$scrollContainer.css("width",b+"px"),b}function g(a){var b,c,d=new Array(this.numSteps),e=this.viewportWidth-this.scrollChildrenWidth,f=this.numSteps-1;if(d[0]=0,d[f]=e,a)for(b=1;f>b;b++)d[b]=-(b*this.viewportWidth);else for(b=f-1,c=1;b>0;b--,c++)d[b]=e+c*this.viewportWidth;this.stepPositions=d}function h(){var b=this.$el,c=this.$viewport;this.$previous&&(this.$previous.off("click"+u),this.$previous.on("click"+u,a.proxy(this.previous,this))),this.$next&&(this.$next.off("click"+u),this.$next.on("click"+u,a.proxy(this.next,this))),b.off("mouseenter"+u),b.off("mouseleave"+u),b.on("mouseenter"+u,function(){b.addClass("mouse-enter"),b.data("mouse-enter","yes")}),b.on("mouseleave"+u,function(){b.removeClass("mouse-enter"),b.removeData("mouse-enter")}),c.on("touchstart"+u,a.proxy(q,this)),c.on("touchcancel"+u,a.proxy(t,this))}function i(){this.$scrollContainer.stop()}function j(a){var b=this;this.$scrollContainer.animate({transform:"translateX("+a+")"},this.isShortTouch?this.settings.flickScrollDuration:this.settings.scrollDuration,this.settings.scrollEasing,function(){b.settings.completeCallback(b)})}function k(){j.call(this,this.stepPositions[this.stepIndex])}function l(){this.$previous&&this.$previous.removeClass("disabled"),this.$next&&this.$next.removeClass("disabled"),this.isAtStart=this.isAtEnd=!1}function m(){var a=this.$viewport.css("transform");return"none"===a?1:parseFloat(b(a)[0])}function n(){this.$viewport.off("touchmove"+u),this.$viewport.off("touchend"+u),this.touch=null,clearTimeout(this.timeoutId),this.timeoutId=0,this.isShortTouch=!1}function o(a){if(!this.touch)return null;var b,c=a.length;for(b=0;c>b;b++)if(a[b].identifier===this.touch.identifier)return a[b];return null}function p(a){return(a.pageX-this.touch.pageX)/m.call(this)}function q(c){var e=this.$viewport,f=this;this.touch||(i.call(this),this.touchStartMatrix=b(this.$scrollContainer.css("transform")),this.touch=d(c.originalEvent.changedTouches[0]),e.on("touchmove"+u,a.proxy(r,this)),e.on("touchend"+u,a.proxy(s,this)),this.isShortTouch=!0,this.timeoutId=setTimeout(a.proxy(function(){f.isShortTouch=!1},f),250))}function r(a){var b=o.call(this,a.originalEvent.changedTouches);if(a.preventDefault(),b){var d=this.touchStartMatrix.slice(0);d[4]=parseInt(this.touchStartMatrix[4])+p.call(this,b),this.$scrollContainer.css("transform",c(d))}}function s(a){var b=o.call(this,a.originalEvent.changedTouches);if(b){var c=p.call(this,b);Math.abs(c)>=this.viewportWidth/2||this.isShortTouch&&Math.abs(c)>=this.settings.shortTouchXLimit?0>c?this.isAtEnd?k.call(this):this.next():this.isAtStart?k.call(this):this.previous():k.call(this),n.call(this)}}function t(a){var b=o.call(this,a.originalEvent.changedTouches);b&&(n.call(this),k.call(this))}var u=".wrscroller";a.WRScroller=function(b,c){this.el=b,this.$el=a(b),e.call(this,c)},a.WRScroller.prototype.previous=function(){return this.stepIndex>0&&(i.call(this),j.call(this,this.stepPositions[--this.stepIndex]),l.call(this),0===this.stepIndex&&(this.$previous.addClass("disabled"),this.isAtStart=!0,g.call(this,!0))),this},a.WRScroller.prototype.next=function(){return this.stepIndex<this.numSteps-1&&(i.call(this),j.call(this,this.stepPositions[++this.stepIndex]),l.call(this),this.stepIndex===this.numSteps-1&&(this.$next.addClass("disabled"),this.isAtEnd=!0,g.call(this,!1))),this},a.WRScroller.prototype.destroy=function(){var a=this.$el,b=this.$viewport;i.call(this),l.call(this),this.$previous&&this.$previous.off("click"+u),this.$next&&this.$next.off("click"+u),a.off("mouseenter"+u),a.off("mouseleave"+u),b.off("touchstart"+u),b.off("touchmove"+u),b.off("touchend"+u),a.removeClass("mouse-enter"),a.removeData("mouse-enter"),a.removeData("wrscroller"),this.$scrollContainer.removeAttr("style")},a.fn.wrscroller=function(b){var c=a.extend({},a.fn.wrscroller.defaults,b||{});return this.each(function(){var b=a(this);b.data("wrscroller")||b.data("wrscroller",new a.WRScroller(this,c))})},a.fn.wrscroller.defaults={scrollDuration:250,flickScrollDuration:125,scrollEasing:"swing",viewportSelector:".viewport",previouseSelector:".previous",nextSelector:".next",shortTouchXLimit:10,completeCallback:function(){}}}(jQuery);